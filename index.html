<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haunted Empire - Creator Monetization Platform</title>
    <script src="config.js"></script>
    <script src="main.js"></script>
    <script src="payment-link-updater.js"></script>
    <!-- Analytics: Google Analytics or Plausible (privacy-friendly) -->
    <script defer data-domain="haunted-empire.com" src="https://plausible.io/js/plausible.js"></script>
    <script>
      window.analyticsTrack = function(event, props) {
        if (window.plausible) plausible(event, {props});
      };
      
      // Global error handler for JSON parsing errors
      window.addEventListener('error', function(event) {
        if (event.error && event.error.message && event.error.message.includes('Unexpected token')) {
          console.warn('üîß JSON parsing error caught and handled:', event.error.message);
          event.preventDefault(); // Prevent the error from showing in console
          return true;
        }
      });
      
      // Global promise rejection handler
      window.addEventListener('unhandledrejection', function(event) {
        if (event.reason && event.reason.message && event.reason.message.includes('is not valid JSON')) {
          console.warn('üîß JSON promise rejection caught and handled:', event.reason.message);
          event.preventDefault(); // Prevent unhandled rejection
          return true;
        }
      });
    </script>
    
    <!-- EMERGENCY ADMIN BUTTON - INLINE CREATION -->
    <script>
    (function() {
        console.log('üö® EMERGENCY ADMIN BUTTON SCRIPT LOADING...');
        
        function createEmergencyAdminButton() {
            console.log('üî¥ Creating emergency admin button...');
            
            // Remove any existing admin buttons first
            const existing = document.querySelectorAll('[id*="admin"], [class*="admin"]');
            existing.forEach(el => {
                if (el.textContent.includes('Admin') || el.textContent.includes('admin')) {
                    el.remove();
                }
            });
            
            const btn = document.createElement('button');
            btn.id = 'emergency-admin-btn';
            btn.textContent = 'üî¥ ADMIN ACCESS';
            btn.style.cssText = `
                position: fixed !important;
                top: 10px !important;
                right: 10px !important;
                z-index: 2147483647 !important;
                background: linear-gradient(135deg, #ff0000, #cc0000) !important;
                color: white !important;
                border: 3px solid #ffffff !important;
                padding: 15px 25px !important;
                font-size: 16px !important;
                font-weight: bold !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                box-shadow: 0 0 20px rgba(255,0,0,0.8) !important;
                animation: emergencyPulse 2s infinite !important;
                font-family: Arial, sans-serif !important;
                width: 150px !important;
                height: 60px !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            `;
            
            btn.onclick = function() {
                console.log('üî¥ Emergency admin button clicked!');
                const username = prompt('Admin Username:');
                const password = prompt('Admin Password:');
                const adminKey = prompt('Admin Key:');
                
                if (username === 'PhantomDp' && password === 'Sarastine50!' && adminKey === 'TMT27') {
                    alert('‚úÖ Admin Access Granted!');
                    // Open admin panel
                    if (typeof showAdminDashboard === 'function') {
                        showAdminDashboard();
                    } else {
                        alert('Admin dashboard loading...');
                        window.location.hash = '#admin';
                    }
                } else {
                    alert('‚ùå Access Denied!');
                }
            };
            
            document.body.appendChild(btn);
            console.log('‚úÖ Emergency admin button created and added to DOM');
            
            // Add CSS animation
            if (!document.getElementById('emergency-admin-css')) {
                const style = document.createElement('style');
                style.id = 'emergency-admin-css';
                style.textContent = `
                    @keyframes emergencyPulse {
                        0% { transform: scale(1); box-shadow: 0 0 20px rgba(255,0,0,0.8); }
                        50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(255,0,0,1); }
                        100% { transform: scale(1); box-shadow: 0 0 20px rgba(255,0,0,0.8); }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // Try to create button immediately
        if (document.body) {
            createEmergencyAdminButton();
        } else {
            // Wait for body to exist
            const observer = new MutationObserver(function(mutations) {
                if (document.body) {
                    observer.disconnect();
                    createEmergencyAdminButton();
                }
            });
            observer.observe(document.documentElement, { childList: true, subtree: true });
        }
        
        // Also try when DOM is ready
        document.addEventListener('DOMContentLoaded', createEmergencyAdminButton);
        
        // And try after a delay
        setTimeout(createEmergencyAdminButton, 1000);
        setTimeout(createEmergencyAdminButton, 3000);
        
        console.log('üö® Emergency admin button script loaded');
    })();
    </script>
    
    <!-- INSTANT ADMIN BUTTON - BYPASSES EVERYTHING -->
    <div id="instant-admin-btn" style="
        position: fixed !important;
        top: 5px !important;
        right: 5px !important;
        z-index: 2147483647 !important;
        background: #ff0000 !important;
        color: white !important;
        border: 2px solid white !important;
        padding: 10px 20px !important;
        font-size: 14px !important;
        font-weight: bold !important;
        border-radius: 5px !important;
        cursor: pointer !important;
        box-shadow: 0 0 10px red !important;
        font-family: Arial !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        width: 120px !important;
        height: 40px !important;
        text-align: center !important;
        line-height: 20px !important;
    " onclick="
        const u = prompt('Username:');
        const p = prompt('Password:');
        const k = prompt('Admin Key:');
        if (u === 'PhantomDp' && p === 'Sarastine50!' && k === 'TMT27') {
            alert('‚úÖ ADMIN ACCESS GRANTED!');
            if (typeof showAdminDashboard === 'function') showAdminDashboard();
            else window.location.hash = '#admin';
        } else {
            alert('‚ùå ACCESS DENIED');
        }
    ">üî¥ ADMIN</div>
    
    <meta name="description" content="Haunted Empire provides monetization tools and services for horror content creators, including payment processing and revenue tracking.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 25%, #2a0a2a 50%, #1a0a1a 75%, #0a0a0a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 107, 107, 0.3);
        }
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        .nav-links a {
            color: #e0e0e0;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-links a:hover {
            color: #ff6b6b;
        }
        .hero {
            text-align: center;
            padding: 4rem 0;
        }
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .section {
            padding: 3rem 0;
            margin: 2rem 0;
        }
        .section h2 {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #ff6b6b;
        }
        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .service-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 107, 0.2);
        }
        .service-card h3 {
            color: #4ecdc4;
            margin-bottom: 1rem;
        }
        .footer {
            background: rgba(0, 0, 0, 0.3);
            padding: 3rem 0;
            margin-top: 4rem;
        }
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        .footer h3 {
            color: #ff6b6b;
            margin-bottom: 1rem;
        }
        .footer a {
            color: #ccc;
            text-decoration: none;
        }
        .footer a:hover {
            color: #4ecdc4;
        }
        
        /* Horror-themed illustrations and visual elements */
        .horror-illustration {
            position: relative;
            display: inline-block;
            margin: 20px;
        }
        
        .spooky-border {
            border: 3px solid transparent;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ff6b6b) border-box;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .spooky-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff0000, #8b0000, #ff4500);
            border-radius: 15px;
            z-index: -1;
            animation: spookyGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes spookyGlow {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.02); }
        }
        
        .floating-ghost {
            position: fixed;
            font-size: 2rem;
            opacity: 0.7;
            animation: ghostFloat 6s ease-in-out infinite;
            z-index: 100;
            pointer-events: none;
        }
        
        @keyframes ghostFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .creepy-eyes {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff0000;
            border-radius: 50%;
            box-shadow: 0 0 10px #ff0000;
            animation: blink 4s infinite;
        }
        
        @keyframes blink {
            0%, 90%, 100% { opacity: 1; }
            95% { opacity: 0; }
        }
        
        .horror-card-illustration {
            text-align: center;
            font-size: 4rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5));
            animation: subtlePulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes subtlePulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5)); }
            100% { transform: scale(1.05); filter: drop-shadow(0 0 20px rgba(255, 107, 107, 0.8)); }
        }
        
        .blood-drip {
            position: relative;
            overflow: hidden;
        }
        
        .blood-drip::after {
            content: 'ü©∏';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            animation: drip 3s infinite;
            font-size: 1.5rem;
        }
        
        @keyframes drip {
            0% { top: -10px; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        
        .skeleton-hand {
            position: absolute;
            font-size: 2rem;
            animation: skellyWave 4s ease-in-out infinite;
        }
        
        @keyframes skellyWave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(20deg); }
            75% { transform: rotate(-10deg); }
        }
        
        .horror-background-pattern {
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                linear-gradient(45deg, transparent 49%, rgba(255, 255, 255, 0.02) 50%, transparent 51%);
        }
        
        .spooky-shadow {
            box-shadow: 
                0 0 20px rgba(255, 107, 107, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        /* Patreon Social Integration */
        .patreon-section {
            background: linear-gradient(135deg, #f96854, #ff6b6b);
            border: 3px solid #f96854;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 40px 0;
            position: relative;
            overflow: hidden;
        }
        
        .patreon-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #f96854, #ff6b6b, #f96854);
            border-radius: 15px;
            z-index: -1;
            animation: patreonGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes patreonGlow {
            0% { opacity: 0.7; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.02); }
        }
        
        .patreon-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: patreonFloat 4s ease-in-out infinite alternate;
        }
        
        @keyframes patreonFloat {
            0% { transform: translateY(0px) scale(1); }
            100% { transform: translateY(-10px) scale(1.05); }
        }
        
        .patreon-btn {
            background: #f96854;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(249, 104, 84, 0.4);
        }
        
        .patreon-btn:hover {
            background: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 104, 84, 0.6);
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .social-link {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .social-link:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .social-link.patreon {
            background: #f96854;
            color: white;
        }
        
        .social-link.patreon:hover {
            background: #ff6b6b;
            transform: translateY(-2px) scale(1.05);
        }
        
        .tier-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .tier-card {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #f96854;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .tier-price {
            font-size: 2rem;
            color: #f96854;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .tier-benefits {
            list-style: none;
            padding: 0;
        }
        
        .tier-benefits li {
            margin: 8px 0;
            color: #ccc;
        }
        
        .tier-benefits li::before {
            content: 'üëª ';
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">üëª Haunted Empire</div>
            <ul class="nav-links">
                <li><a href="#about">About</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="courses.html">Courses</a></li>
                <li><a href="subscribe.html">Subscribe</a></li>
                <li><a href="books.html">Books</a></li>
                <li><a href="premium.html">Premium</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#pricing">Pricing</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Feature Flags (A/B Testing) -->
    <script>
      window.FEATURE_FLAGS = {
        promoBanner: true,
        loreDrop: true,
        referralBanner: true,
        leaderboardGrowth: true,
        stripeWebhookBadge: true
      };
    </script>
    <!-- Email Capture Modal -->
    <div id="email-modal" class="hidden email-modal">
      <div class="email-modal-content">
        <h2 class="email-modal-title">Unlock More Earnings!</h2>
        <p>Enter your email for exclusive offers and bonus credits.</p>
        <input type="email" id="user-email" placeholder="Your email" class="email-input">
        <button id="email-submit" class="monetization-btn lore">Submit</button>
        <button id="email-close" class="monetization-btn status email-close">Close</button>
      </div>
    </div>

    <!-- Referral Banner -->
    <div class="ad-promo referral-banner hidden" id="referral-banner">
      <span>Refer a friend &amp; earn $10 in credits!</span>
      <input type="text" id="referral-link" readonly class="referral-link" placeholder="Your referral link" title="Referral link for sharing">
      <button class="monetization-btn lore" id="copy-referral">Copy Link</button>
    </div>

    <!-- Leaderboard -->
    <section class="section" id="leaderboard-section">
      <div class="container">
        <h2>Top Earners This Week</h2>
        <ol id="leaderboard" class="leaderboard-list"></ol>
      </div>
    </section>

    <main>
        <!-- Monetization & Backend Integration Buttons -->
        <section class="section monetization-section">
            <h2>Monetization Actions</h2>
            <button onclick="triggerStripePayment()" class="monetization-btn">Test Stripe Payment</button>
            <button onclick="triggerLoreDrop()" class="monetization-btn lore">Trigger Live Lore Drop</button>
            <button onclick="fetchStats()" class="monetization-btn status">Show Backend Status</button>
        </section>
        <!-- Alert and Stats containers -->
        <div id="alert-box"></div>
        <div id="stats-box"></div>
        <section class="hero horror-background-pattern">
            <div class="container">
                <!-- Floating horror elements -->
                <div class="floating-ghost" style="top: 10%; left: 10%;">üëª</div>
                <div class="floating-ghost" style="top: 20%; right: 15%; animation-delay: -2s;">üéÉ</div>
                <div class="floating-ghost" style="top: 15%; left: 80%; animation-delay: -4s;">ü¶á</div>
                <div class="floating-ghost" style="bottom: 30%; left: 5%;">üï∑Ô∏è</div>
                
                <!-- Enhanced hero content -->
                <div class="hero-content">
                    <!-- Main horror illustration -->
                    <div class="horror-card-illustration">üè∞üíÄüìö</div>
                    
                    <!-- Enhanced title with glitch effect -->
                    <h1 class="horror-title glitch-text spooky-border blood-drip">Haunted Empire</h1>
                    
                    <!-- Improved subtitle -->
                    <p class="hero-description">The premier monetization platform for horror content creators. Unleash your dark creativity with our supernatural tools for payment processing, revenue tracking, and creator management.</p>
                    
                    <!-- Enhanced CTA buttons -->
                    <div class="hero-buttons">
                        <a href="shop.html" class="horror-btn hover-lift">
                            üõí Start Shopping
                            <span class="btn-shine"></span>
                        </a>
                        <a href="courses.html" class="ghost-btn hover-lift">
                            üìö Learn Horror Writing
                            <span class="btn-shine"></span>
                        </a>
                        <a href="#features" class="horror-btn-outline hover-glow">
                            ‚ö° Explore Features
                        </a>
                    </div>
                    
                    <!-- Stats counter -->
                    <div class="hero-stats">
                        <div class="stat-item floating enhanced-card">
                            <div class="stat-number">1,337+</div>
                            <div class="stat-label">Cursed Writers</div>
                            <div class="stat-icon">‚úçÔ∏è</div>
                        </div>
                        <div class="stat-item floating enhanced-card" style="animation-delay: 0.5s;">
                            <div class="stat-number">666+</div>
                            <div class="stat-label">Dark Stories</div>
                            <div class="stat-icon">üìñ</div>
                        </div>
                        <div class="stat-item floating enhanced-card" style="animation-delay: 1s;">
                            <div class="stat-number">13</div>
                            <div class="stat-label">Horror Tools</div>
                            <div class="stat-icon">üîß</div>
                        </div>
                    </div>
                </div>
                
                <!-- Creepy eyes scattered around -->
                <div class="creepy-eyes" style="top: 50px; left: 20%;"></div>
                <div class="creepy-eyes" style="top: 80px; right: 25%; animation-delay: -1s;"></div>
                <div class="skeleton-hand" style="bottom: 20px; right: 10%;">üñêÔ∏è</div>
            </div>
        </section>

        <section id="about" class="section">
            <div class="container">
                <h2>About Haunted Empire</h2>
        <!-- Monetization Banner: Dynamic Ad Promo -->
        <div class="ad-promo" data-featured id="promo-banner">
          <span class="ci-status-badge" data-success id="promo-status">Live</span>
          <span id="promo-message">üéâ Limited Time: Get 2x Lore Credits on all purchases!</span>
          <button class="monetization-btn lore" id="promo-action">Claim Now</button>
        </div>

        <!-- Dynamic Lore Drop Section -->
        <div class="lore-drop" data-new id="lore-drop">
          <span class="ci-status-badge" data-success id="lore-status">Deployed</span>
          <strong id="lore-title">New Lore Drop:</strong>
          <span id="lore-content">The Haunted Empire expands with the Shadow Market! Earn bonus credits for early access.</span>
          <button class="monetization-btn status" id="lore-action">Unlock Early Access</button>
        </div>

    <!-- CI/CD Status Badges (Dynamic) -->
    <div class="ci-status-container">
      <span class="ci-status-badge" data-success id="build-status">Build Passed</span>
      <span class="ci-status-badge" data-fail id="deploy-status">Deploy Failed</span>
      <span class="ci-status-badge" data-success id="stripe-webhook-status" style="display:none">Stripe Payouts: OK</span>
    </div>

        <script>
          // Stripe Checkout Integration
          function openStripeCheckout(product) {
            fetch('/create-checkout-session', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ product })
            })
            .then(res => res.json())
            .then(data => {
              if (data.url) window.location = data.url;
              else alert('Payment error.');
              analyticsTrack('stripe_checkout', {product});
            });
          }

          // Promo Banner A/B Test
          document.getElementById('promo-action').onclick = function() {
            openStripeCheckout('lore-credits');
            document.getElementById('promo-message').textContent = '‚úÖ Claimed! Your bonus credits are on the way.';
            document.getElementById('promo-status').setAttribute('data-success', '');
            analyticsTrack('promo_claimed', {variant: 'A'});
          };

          // Lore Drop A/B Test
          document.getElementById('lore-action').onclick = function() {
            openStripeCheckout('early-access');
            document.getElementById('lore-content').textContent = '‚úÖ Early access unlocked! You earned bonus credits.';
            document.getElementById('lore-status').setAttribute('data-success', '');
            analyticsTrack('loredrop_unlocked', {variant: 'A'});
          };

          // Email Capture Modal Logic & Analytics
          setTimeout(() => {
            document.getElementById('email-modal').classList.remove('hidden');
            analyticsTrack('email_modal_shown', {});
          }, 2000);
          document.getElementById('email-close').onclick = function() {
            document.getElementById('email-modal').classList.add('hidden');
            analyticsTrack('email_modal_closed', {});
          };
          document.getElementById('email-submit').onclick = function() {
            const email = document.getElementById('user-email').value;
            if (!email || !email.includes('@')) return alert('Enter a valid email.');
            fetch('/api/email-capture', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email })
            }).then(() => {
              document.getElementById('email-modal').classList.add('hidden');
              document.getElementById('referral-banner').style.display = 'block';
              document.getElementById('referral-link').value = window.location.origin + '/?ref=' + btoa(email);
              analyticsTrack('email_captured', {email});
            });
          };

          // Referral System & Analytics
          document.getElementById('copy-referral').onclick = function() {
            navigator.clipboard.writeText(document.getElementById('referral-link').value);
            document.getElementById('copy-referral').textContent = 'Copied!';
            analyticsTrack('referral_copied', {});
            setTimeout(() => document.getElementById('copy-referral').textContent = 'Copy Link', 2000);
          };

          // Leaderboard Fetch & Personal Rank
          function updateLeaderboard() {
            fetch('/api/leaderboard')
              .then(res => res.json())
              .then(data => {
                const lb = document.getElementById('leaderboard');
                lb.innerHTML = '';
                let myEmail = '';
                try { myEmail = atob((new URLSearchParams(window.location.search)).get('ref') || ''); } catch(e) {}
                let myRank = null, myGrowth = null;
                data.forEach((user, i) => {
                  const li = document.createElement('li');
                  li.textContent = `#${i+1} ${user.name} ‚Äî $${user.earnings} this week`;
                  if (window.FEATURE_FLAGS.leaderboardGrowth && user.growth) {
                    li.textContent += ` (+${user.growth}% growth)`;
                  }
                  if (myEmail && user.email === myEmail) {
                    myRank = i+1;
                    myGrowth = user.growth;
                    li.style.fontWeight = 'bold';
                  }
                  lb.appendChild(li);
                });
                if (myRank) {
                  const statsBox = document.getElementById('stats-box');
                  statsBox.innerHTML = `<div>Your Rank: #${myRank} | Weekly Growth: ${myGrowth || 'N/A'}%</div>`;
                }
                analyticsTrack('leaderboard_viewed', {myRank, myGrowth});
              });
          }
          updateLeaderboard();

          // Backend Status Auto-Refresh & Error Reporting
          function fetchStats() {
            fetch('/api/status')
              .then(res => res.json())
              .then(data => {
                document.getElementById('stats-box').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                analyticsTrack('backend_status_viewed', {});
              })
              .catch(err => {
                document.getElementById('stats-box').innerHTML = `<span style='color:red'>Error: ${err.message}</span>`;
                analyticsTrack('backend_status_error', {error: err.message});
              });
          }
          setInterval(fetchStats, 60000); // Auto-refresh every 60s

          // Stripe Webhook Status Badge
          function checkStripeWebhook() {
            fetch('/api/stripe-webhook-status')
              .then(res => res.json())
              .then(data => {
                const badge = document.getElementById('stripe-webhook-status');
                if (data.ok) {
                  badge.style.display = 'inline-block';
                  badge.textContent = 'Stripe Payouts: OK';
                  badge.setAttribute('data-success', '');
                } else {
                  badge.style.display = 'inline-block';
                  badge.textContent = 'Stripe Payouts: Error';
                  badge.setAttribute('data-fail', '');
                }
                analyticsTrack('stripe_webhook_checked', {ok: data.ok});
              });
          }
          if (window.FEATURE_FLAGS.stripeWebhookBadge) setInterval(checkStripeWebhook, 120000); // Every 2 min

          // Simulate CI/CD status change
          setTimeout(function() {
            document.getElementById('deploy-status').setAttribute('data-success', '');
            document.getElementById('deploy-status').textContent = 'Deploy Succeeded';
            analyticsTrack('deploy_status_changed', {status: 'succeeded'});
          }, 4000);
        </script>
                <p>Haunted Empire is a specialized platform designed to help horror content creators monetize their supernatural storytelling. We provide comprehensive payment processing services, revenue tracking tools, and creator management systems tailored specifically for the horror content community.</p>
                
                <p>Our platform enables creators to:</p>
                <ul class="info-list">
                    <li>Process payments for premium horror content</li>
                    <li>Track revenue with tier-based multipliers</li>
                    <li>Manage subscriber relationships</li>
                    <li>Access detailed analytics and reporting</li>
                </ul>
            </div>
        </section>

        <section id="services" class="section horror-background-pattern">
            <div class="container">
                <h2 class="spooky-shadow">Our Services</h2>
                <div class="services">
                    <div class="service-card spooky-border">
                        <div class="horror-card-illustration">üí≥üëª</div>
                        <h3>üí≥ Payment Processing</h3>
                        <p>Secure payment processing for creator content purchases, subscriptions, and donations. Full PCI compliance and fraud protection.</p>
                    </div>
                    <div class="service-card spooky-border">
                        <div class="horror-card-illustration">üìäüßõ‚Äç‚ôÇÔ∏è</div>
                        <h3>üìä Revenue Analytics</h3>
                        <p>Comprehensive revenue tracking with tier-based multipliers, real-time analytics, and detailed financial reporting.</p>
                    </div>
                    <div class="service-card spooky-border">
                        <div class="horror-card-illustration">üëëüï∑Ô∏è</div>
                        <h3>üëë Creator Management</h3>
                        <p>Advanced creator ranking system, leaderboards, and performance tracking tools to help creators grow their audience.</p>
                    </div>
                    <div class="service-card spooky-border">
                        <div class="horror-card-illustration">üîÑüíÄ</div>
                        <h3>üîÑ Subscription Management</h3>
                        <p>Flexible subscription models for recurring content, automatic billing, and customer relationship management.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Patreon Social Integration Section -->
        <section class="section">
            <div class="container">
                <div class="patreon-section">
                    <div class="patreon-icon">üéÉüíÄüìö</div>
                    <h2>Support Our Horror Writing Community</h2>
                    <p>Join our Patreon to get exclusive horror writing content, early access to courses, and support the growth of our spooky community!</p>
                    
                    <div class="tier-preview">
                        <div class="tier-card">
                            <div class="tier-price">$5</div>
                            <h4>üëª Ghostly Supporter</h4>
                            <ul class="tier-benefits">
                                <li>Early access to blog posts</li>
                                <li>Exclusive writing prompts</li>
                                <li>Community Discord access</li>
                            </ul>
                        </div>
                        <div class="tier-card">
                            <div class="tier-price">$15</div>
                            <h4>üßõ‚Äç‚ôÇÔ∏è Vampire Patron</h4>
                            <ul class="tier-benefits">
                                <li>All previous tier benefits</li>
                                <li>Monthly live Q&A sessions</li>
                                <li>10% off all courses</li>
                                <li>Exclusive writing worksheets</li>
                            </ul>
                        </div>
                        <div class="tier-card">
                            <div class="tier-price">$30</div>
                            <h4>üèöÔ∏è Haunted Mansion VIP</h4>
                            <ul class="tier-benefits">
                                <li>All previous tier benefits</li>
                                <li>1-on-1 monthly mentorship call</li>
                                <li>25% off all courses</li>
                                <li>Custom story feedback</li>
                                <li>Beta access to new courses</li>
                            </ul>
                        </div>
                    </div>
                    
                    <a href="https://www.patreon.com/PhantomDp" class="patreon-btn" target="_blank">
                        üé≠ Support on Patreon
                    </a>
                    
                    <div class="social-links">
                        <a href="#" class="social-link patreon" onclick="openSocialLink('patreon'); return false;">
                            üé≠ Patreon
                        </a>
                        <a href="#" class="social-link" onclick="openSocialLink('facebook'); return false;">
                            üìò Facebook
                        </a>
                        <a href="#" class="social-link" onclick="openSocialLink('twitter'); return false;">
                            üê¶ Twitter
                        </a>
                        <a href="#" class="social-link" onclick="openSocialLink('instagram'); return false;">
                            üì∏ Instagram
                        </a>
                        <a href="#" class="social-link" onclick="openSocialLink('linkedin'); return false;">
                            üíº LinkedIn
                        </a>
                        <a href="#" class="social-link" onclick="openSocialLink('youtube'); return false;">
                            üé¨ YouTube
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <section id="pricing" class="section">
            <div class="container">
                <h2>Pricing</h2>
                <p>We offer competitive transaction fees with no monthly subscription costs:</p>
                <ul class="info-list">
                    <li><strong>Payment Processing:</strong> 2.9% + $0.30 per transaction</li>
                    <li><strong>Creator Tools:</strong> Free access to all creator management features</li>
                    <li><strong>Analytics:</strong> Real-time reporting included at no additional cost</li>
                    <li><strong>Support:</strong> 24/7 technical support for all users</li>
                </ul>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div>
                    <h3>Contact Information</h3>
                    <p>Website: https://phantomgear.it.com</p>
                    <p>Email: support@phantomgear.it.com</p>
                    <p>Business Hours: Monday-Friday, 9 AM - 6 PM PST</p>
                    <p>Emergency Support: 24/7 for payment issues</p>
                </div>
                
                <div>
                    <h3>Legal</h3>
                    <p><a href="#terms">Terms of Service</a></p>
                    <p><a href="#privacy">Privacy Policy</a></p>
                    <p><a href="#refund">Refund Policy</a></p>
                    <p><a href="#acceptable-use">Acceptable Use Policy</a></p>
                </div>
                
                <div>
                    <h3>Business Information</h3>
                    <p>PhantomGear Technologies</p>
                    <p>Website: https://phantomgear.it.com</p>
                    <p>Specializing in creator monetization platforms</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 PhantomGear Technologies. All rights reserved. | Payment processing powered by Stripe.</p>
            </div>
        </div>
    </footer>

    <!-- Legal Pages (Hidden, linked from footer) -->
    <div id="terms" class="hidden">
        <h2>Terms of Service</h2>
        <p>By using Haunted Empire services, you agree to our terms of service...</p>
    </div>

    <div id="privacy" class="hidden">
        <h2>Privacy Policy</h2>
        <p>We respect your privacy and are committed to protecting your personal information...</p>
    </div>

    <div id="refund" class="hidden">
        <h2>Refund Policy</h2>
        <p>Refunds are processed according to our 30-day return policy...</p>
    </div>

    <!-- Enhanced JavaScript -->
    <script src="main.js"></script>
    <script src="enhanced-features.js"></script>
    <script src="analytics-ai.js"></script>
    <script src="ai-writing-tools.js"></script>
    <script src="admin-auth.js"></script>
    <script src="force-admin-button.js"></script>
    <script src="quantum-narrative.js"></script>
    <script src="quantum-monetization.js"></script>
    <script src="synthetic-intent.js"></script>
    <script src="platform-triggers.js"></script>
    <script src="autonomous-wealth.js"></script>
    <script src="mobile-social.js"></script>
    
    <!-- Initialize all features -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Haunted Empire - All Systems Loading...');
            
            // Initialize notification system
            window.showNotification = function(message, type = 'info', duration = 5000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    z-index: 10005;
                    animation: slideIn 0.3s ease;
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, duration);
            };
            
            // Add notification animations
            const notificationStyles = document.createElement('style');
            notificationStyles.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(notificationStyles);
            
            // Add navigation to AI Writing Tools
            const navigation = document.querySelector('nav ul');
            if (navigation && !document.getElementById('ai-tools-nav')) {
                const aiToolsLink = document.createElement('li');
                aiToolsLink.id = 'ai-tools-nav';
                aiToolsLink.innerHTML = '<a href="writing-tools.html" class="nav-link">ü§ñ AI Writing Tools</a>';
                navigation.appendChild(aiToolsLink);
            }
            
            // Initialize progress dashboard function
            window.showProgressDashboard = function() {
                toggleAnalyticsDashboard();
            };
            
            // Initialize sound system function
            window.toggleSoundSystem = function() {
                soundEnabled = !soundEnabled;
                localStorage.setItem('soundEnabled', soundEnabled);
                showNotification(soundEnabled ? 'üîä Sound enabled!' : 'üîá Sound disabled!', 'info');
                userPreferences.soundEnabled = soundEnabled;
                localStorage.setItem('userPreferences', JSON.stringify(userPreferences));
            };
            
            // Welcome message
            setTimeout(() => {
                showNotification('üéÉ Welcome to Haunted Empire! All systems ready.', 'success');
            }, 1000);
            
            // Force admin button as fallback
            if (typeof forceCreateAdminButton === 'function') {
                console.log('üîß Calling force admin button fallback...');
                forceCreateAdminButton();
            }
            
            console.log('‚úÖ All features loaded successfully!');
        });
    </script>
</body>
</html>
